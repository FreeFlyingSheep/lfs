# LFS 自动构建脚本

虽然本人已经经过一定测试，但仍然强烈建议在虚拟机中的 Linux 发行版上运行，避免损害主机系统。

## 注意事项

确保脚本所在磁盘有至少 10G 的剩余空间。

该脚本运行过程中会创建 `lfs` 用户组及 `lfs` 用户，确保系统中没有重名的用户和用户组。

确保 /mnt/lfs 目录不存在或为空，否则它会被删除！！！

再次强调，强烈建议在虚拟机中的 Linux 发行版上运行，避免损害主机系统。如果不是新建的虚拟机，或者虚拟机还需要有别的用途，建议做好备份。

**对运行该脚本可能产生的一切后果，本人概不负责！！！**

## 运行

在 Linux 发行版上，运行以下命令：

    sudo su - # 切换到 root 用户
    bash build.sh # 执行自动构建脚本

确认宿主机环境正确配置后，输入 `1` 继续；反之输入 `2` 退出，完成环境配置后再次运行该脚本。

如果中途需要进行注销、关机、重启等可能卸载虚拟磁盘的操作，按 `ctrl + c` 终止脚本，然后**再次执行脚本，选择“保存状态”**，否则下次将无法正确运行。

## 流程

详细内容可以参考脚本注释及 LFS 官方手册 “[Linux From Scratch 版本 20200901-systemd，中文翻译版](https://bf.mengyan1223.wang/lfs/zh_CN/10.0-systemd/)”，脚本内容按照该手册编排，修改了少部分指令。

### 0. 说明

该部分打印脚本信息。

### 1. 引言

确保执行脚本的用户为 `root`。

切换到脚本所在的目录，导出一些环境变量。

清理上次的构建（如果存在的话）。

### 2. 准备宿主系统

导出 `$LFS` 环境变量。

调用官方的 `version-check.sh` 脚本，打印宿主系统环境信息，给用户选择是否继续执行。

若用户选择继续执行，导出 `$LFS` 环境变量，创建虚拟磁盘，对其进行分区、格式化然后挂载。

### 3. 软件包和补丁

从官方镜像下载 [lfs-packages-10.0.tar](http://ftp.lfs-matrix.net/pub/lfs/lfs-packages/lfs-packages-10.0.tar)，然后解包到 `$LFS/sources`。

现在源码内容位于 `$LFS/sources/10.0` 目录，移动目录中的内容到 `$LFS/sources`，之后删除空的 `10.0` 目录。

当然，用户也可以提前下载好软件包，放置到脚本目录。

### 4. 最后准备工作

### 5. 编译交叉工具链

### 6. 交叉编译临时工具

### 7. 进入 Chroot 并构建其他临时工具

### 8. 安装基本系统软件

### 9. 系统配置

### 10. 使 LFS 系统可引导

### 11. 尾声

## 版本

- v0.1：初步完成步骤 0 - 3。
- v0.2：完善步骤 0 - 3，初步完成步骤 4。
